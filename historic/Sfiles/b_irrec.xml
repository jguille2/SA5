<blocks app="Snap4Arduino 1.0.6 beta http://s4a.cat/snap" version="1"><block-definition s="$robot IR rec" type="reporter" category="arduino"><comment x="0" y="0" w="462" collapsed="false">Return IR code (hexadecimal) from IR receiver connected to pin 11.&#xD;&#xD;-You must &quot;Enable IR rec&quot; before. This action disables PWM function on pins 3 and 11.&#xD;-After using this receiver you can &quot;Disable IR rec&quot; to turn on PWM function on pins 3 and 11 again.</comment><header></header><code></code><inputs></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>board = this.arduino.board; //Definition should change according to the context&#xD;if (board.pins[2].supportedModes.indexOf(0x05) === -1) {&#xD;  throw new Error("Please upload SA5Firmata2.ino a higher version");&#xD;}</l></block><list></list></block><block s="doRun"><block s="reportJSFunction"><list></list><l>board = this.arduino.board; //Definition should change according to the context&#xD;//Response definition&#xD;world.Arduino.firmata.SYSEX_RESPONSE[0xCB] = function(board) {&#xD;  var irResult = (board.currentBuffer[2] &amp; 0x7F) &lt;&lt; 25| (board.currentBuffer[3] &amp; 0x7F) &lt;&lt; 18 | (board.currentBuffer[4] &amp; 0x7F) &lt;&lt; 11 | (board.currentBuffer[5] &amp; 0x7F) &lt;&lt; 4 | (board.currentBuffer[6] &amp; 0x7F) &gt;&gt; 3;&#xD;  irResult = irResult &amp; 0xFFFFFF;&#xD;  board.emit("IRrec", irResult);&#xD;}&#xD;//Async reporting&#xD;report = this;&#xD;this.arduino["IRrec"] = null;&#xD;//Launcher&#xD;board.once("IRrec", function(data){report.arduino["IRrec"] = data;});&#xD;var data =[0xF0,//START_SYSEX&#xD;				0xCB,//IR recv command&#xD;				0xF7//END_SYSEX&#xD;];&#xD;board.transport.write(new Buffer(data));</l></block><list></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return (this.arduino["IRrec"] != null);</l></block><list></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list></list><l>return this.arduino["IRrec"].toString(16);</l></block><list></list></block></block></script></block-definition></blocks>