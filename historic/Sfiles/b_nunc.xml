<blocks app="Snap4Arduino 1.0.6 beta http://s4a.cat/snap" version="1"><block-definition s="$robot Nunchuk %&apos;opt&apos;" type="reporter" category="arduino"><comment x="0" y="0" w="472" collapsed="false">Return sensor values from a Nunchuk connected to I2C pins.&#xD;&#xD;-Sensors: Joystick (joyX and joyY), buttons ( butC and butZ) and accelerometers (accX, accY and accZ)&#xD;-Nunchuk I2C connection uses SCL, SDA, Ground and Vcc</comment><header></header><code></code><inputs><input type="%txt" readonly="true">joyX<options>joyX
joyY
butZ
butC
accX
accY
accZ</options></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>board = this.arduino.board; //Definition should change according to the context&#xD;if (board.pins[2].supportedModes.indexOf(0x05) === -1) {&#xD;  throw new Error("Please upload SA5Firmata2.ino a higher version");&#xD;}</l></block><list></list></block><block s="doRun"><block s="reportJSFunction"><list><l>command</l></list><l>//Nunchuk command&#xD;var cCode;&#xD;if (command == "joyX") cCode = 0xC0;&#xD;if (command == "joyY") cCode = 0xC1;&#xD;if (command == "butZ") cCode = 0xC2;&#xD;if (command == "butC") cCode = 0xC3;&#xD;if (command == "accX") cCode = 0xC4;&#xD;if (command == "accY") cCode = 0xC5;&#xD;if (command == "accZ") cCode = 0xC6;&#xD;//Sysex Response definition&#xD;board = this.arduino.board; //Definition should change according to the context&#xD;world.Arduino.firmata.SYSEX_RESPONSE[cCode] = function(board) {&#xD;  if (command == "butZ" || command == "butC") {&#xD;    var value = (board.currentBuffer[2] &amp; 0x7F);&#xD;  } else {&#xD;    var value = (board.currentBuffer[2] &amp; 0x7F) | ((board.currentBuffer[3] &amp; 0x7F) &lt;&lt; 7);&#xD;  }&#xD; 	board.emit(command, value);&#xD;}&#xD;//Async query&#xD;myself = this.arduino;&#xD;this.arduino.nun = new Object();&#xD;this.arduino.nun[command] = null;&#xD;//Launcher&#xD;board.once(command, function(data){myself.nun[command] = data;});&#xD;var sdata =[0xF0,//START_SYSEX,&#xD;				cCode,//nunchuk command&#xD;  		0xF7//END_SYSEX&#xD;];&#xD;board.transport.write(new Buffer(sdata));</l></block><list><block var="opt"/></list></block><block s="doWaitUntil"><block s="evaluate"><block s="reportJSFunction"><list><l>command</l></list><l>return (this.arduino.nun[command] != null);</l></block><list><block var="opt"/></list></block></block><block s="doReport"><block s="evaluate"><block s="reportJSFunction"><list><l>command</l></list><l>return this.arduino.nun[command];</l></block><list><block var="opt"/></list></block></block></script></block-definition></blocks>