<blocks app="Snap4Arduino 1.0.6 beta http://s4a.cat/snap" version="1"><block-definition s="$robot IR %&apos;MESSAGE&apos; send by %&apos;CODER&apos;" type="command" category="arduino"><comment x="0" y="0" w="525" collapsed="false">Send IR signal (hexadecimal code) by IR emitter diode on pin 3, using Sony or RC5 protocol.&#xD;&#xD;You can send values from 0 to FFFFFF.</comment><header></header><code></code><inputs><input type="%txt">FFFFFF</input><input type="%txt" readonly="true">Sony<options>Sony
RC5</options></input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l></l></list><l>board = this.arduino.board; //Definition should change according to the context&#xD;if (board.pins[2].supportedModes.indexOf(0x05) === -1) {&#xD;  throw new Error("Please upload SA5Firmata2.ino a higher version");&#xD;}</l></block><list></list></block><block s="doRun"><block s="reportJSFunction"><list><l>message</l><l>coder</l></list><l>//Create blocs wit vars: message (6 hexadecimal digits) and coder (string)&#xD;board = this.arduino.board;  //Definition should change according to the context&#xD;if (message === undefined || coder === undefined) {&#xD;  throw new Error("Message and coder are required");&#xD;}&#xD;var smessage = parseInt(message,16);&#xD;smessage = smessage &amp; parseInt("FFFFFF",16);&#xD;if (coder == "RC5") {&#xD;  scoder = 1;&#xD;} else {&#xD;  scoder = 0;&#xD;}&#xD;var data =[0xF0, //START_SYSEX&#xD;      		0xCE,  //Send IR&#xD;      		(smessage &gt;&gt; 17) &amp; 0x7F,&#xD;      		(smessage &gt;&gt; 10) &amp; 0x7F,&#xD;      		(smessage &gt;&gt; 3) &amp; 0x7F,&#xD;      		((smessage &lt;&lt; 4) &amp; parseInt("01110000",2)) | (scoder &amp; parseInt("01111",2)),&#xD;      		0xF7  //END_SYSEX&#xD;];&#xD;board.transport.write(new Buffer(data));</l></block><list><block var="MESSAGE"/><block var="CODER"/></list></block></script></block-definition></blocks>